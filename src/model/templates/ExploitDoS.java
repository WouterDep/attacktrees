package model.templates;

import controller.IDPParser;
import model.AttackTree;
import model.AttackTreeNode;
import model.Complexity;
import model.Countermeasure;
import model.Descriptions;
import model.Operation;

/**
 *  ExploitDoSVuln(SystemPart) template
 * @author Wouter
 *
 */
public class ExploitDoS {

	private IDPParser parser;
	private String systemPart;
	private AttackTreeNode node;
	private AttackTree attackTree;
	
	
	public ExploitDoS(IDPParser parser, String systemPart, AttackTreeNode node, AttackTree attackTree) {
		this.parser = parser;
		this.systemPart = systemPart;
		this.node = node;
		this.attackTree = attackTree;
	}

	public void exploitDoS(){
		// root of this template has operation OR
		node.setOperation(Operation.OR);
		attackTree.addCountermeasureToNode(new Countermeasure("Restrict outbound traffic",
				Descriptions.countermeasures.get("Restrict outbound traffic"),Complexity.HIGH,2), node);
		// check if systemPart has DoS vuln
		boolean DoSVuln = false;
		
		if(parser.getHasDoSVuln()!= null)
			for(String s : parser.getHasDoSVuln()){
				if(s.equals(systemPart)) DoSVuln = true;
			}
		
		// vulnerability children
		if (DoSVuln){
			AttackTreeNode exploit = new AttackTreeNode("Exploit known DoS vulnerability in system part " + systemPart);
			attackTree.addCountermeasureToNode(new Countermeasure("Install updates/patches",
					Descriptions.countermeasures.get("Install updates/patches"),Complexity.HIGH,3), exploit);
			exploit.setStealth(2);
			node.addChild(exploit);
			attackTree.addNode(exploit);
		}

		AttackTreeNode discover = new AttackTreeNode("DiscoverDoSVuln(" + systemPart + ")");
		
		node.addChild(discover);
		attackTree.addNode(discover);
		DiscoverDoS discoverTemp = new DiscoverDoS(systemPart, discover, attackTree);
		discoverTemp.discoverDoS();
	}
	
}
